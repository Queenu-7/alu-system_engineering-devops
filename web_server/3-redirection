#!/usr/bin/env bash
# Installs Nginx and configures it:
# - Listens on port 80 (or 8080 as in original script)
# - Serves "Holberton School" at the root
# - Redirects /redirect_me to YouTube with a 301 status

set -e

# Install Nginx if not already installed
sudo apt-get update
sudo apt-get install -y nginx

# Create homepage
echo "Holberton School" | sudo tee /var/www/html/index.html

# Define the redirect block
read -r -d '' REDIRECT_BLOCK << 'EOF'
location /redirect_me {
    return 301 https://www.youtube.com/watch?v=QH2-TGUlwu4;
}
EOF

NGINX_DEFAULT="/etc/nginx/sites-available/default"

# Add redirect block only if it doesn't exist
if ! grep -q "location /redirect_me" "$NGINX_DEFAULT"; then
    sudo sed -i "/server_name _;/a\\
$REDIRECT_BLOCK" "$NGINX_DEFAULT"
fi

# Test Nginx configuration and reload
sudo nginx -t
sudo systemctl restart nginx

