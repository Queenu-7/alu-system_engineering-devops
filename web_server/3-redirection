#!/usr/bin/env bash
# Installs Nginx and configures a redirect for /redirect_me
# Requirements:
#   - Listen on port 80
#   - Return "Holberton School" at the root
#   - Redirect /redirect_me with a 301 Moved Permanently

sudo apt-get update
sudo apt-get install -y nginx

# Add main page
echo "Holberton School" | sudo tee /var/www/html/index.html > /dev/null

# Remove any previous /redirect_me rewrites or location blocks to avoid duplicates
sudo sed -i '/rewrite \^\/redirect_me/d' /etc/nginx/sites-available/default
sudo sed -i '/location \/redirect_me/,/}/d' /etc/nginx/sites-available/default

# Add the correct /redirect_me redirect
sudo sed -i '/server_name _;/a \
    location /redirect_me {\n\
        return 301 https://www.youtube.com/watch?v=QH2-TGUlwu4;\n\
    }' /etc/nginx/sites-available/default

# Ensure Nginx listens on port 80
sudo sed -i 's/listen 8080 default_server;/listen 80 default_server;/g' /etc/nginx/sites-available/default
sudo sed -i 's/listen \[::\]:8080 default_server;/listen [::]:80 default_server;/g' /etc/nginx/sites-available/default

# Test Nginx configuration and restart
sudo nginx -t
sudo systemctl restart nginx

